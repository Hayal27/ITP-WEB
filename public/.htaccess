# Apache Configuration for Security Headers
# This file provides security headers for Apache servers

<IfModule mod_headers.c>
# Content Security Policy
Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: https: http:; connect-src 'self' api.ethiopianitpark.et https://optimizationguide-pa.googleapis.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self';"
    
# Anti-Clickjacking Header
Header always set X-Frame-Options "SAMEORIGIN"
    
# MIME-Sniffing Protection
Header always set X-Content-Type-Options "nosniff"
    
# HSTS (HTTP Strict Transport Security)
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
# Referrer Policy
Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
# Permissions Policy
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    
# Remove X-Powered-By header
Header unset X-Powered-By
Header always unset X-Powered-By
</IfModule>

# Disable directory browsing for security
Options -Indexes

# Enable FollowSymLinks (required for mod_rewrite)
Options +FollowSymLinks

# URL Rewrite for Single Page Application (React Router)
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# Block access to sensitive files
RewriteRule ^\.(env | git | gitignore | vscode | qodo) - [F, L]
RewriteRule ^(package\.json | package-lock\.json | tsconfig.* | vite\.config.* | eslint\.config.* | postcss\.config.* | tailwind\.config.*) - [F, L]
RewriteRule \.(ts | tsx | map)$ - [F, L]

RewriteRule ^index\.html$ - [L]
RewriteCond % { REQUEST_FILENAME } !-f
RewriteCond % { REQUEST_FILENAME } !-d
RewriteRule . /index.html [L]
</IfModule>

# Cache Control for different file types
<IfModule mod_expires.c>
ExpiresActive On
    
# Default expiration
ExpiresDefault "access plus 1 month"
    
# HTML - no caching
ExpiresByType text/html "access plus 0 seconds"
    
# CSS and JavaScript - 1 year
ExpiresByType text/css "access plus 1 year"
ExpiresByType application/javascript "access plus 1 year"
ExpiresByType text/javascript "access plus 1 year"
    
# Images - 1 year
ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType image/png "access plus 1 year"
ExpiresByType image/gif "access plus 1 year"
ExpiresByType image/svg+xml "access plus 1 year"
ExpiresByType image/webp "access plus 1 year"
ExpiresByType image/x-icon "access plus 1 year"
    
# Fonts - 1 year
ExpiresByType font/woff "access plus 1 year"
ExpiresByType font/woff2 "access plus 1 year"
ExpiresByType application/font-woff "access plus 1 year"
ExpiresByType application/font-woff2 "access plus 1 year"
    
# Manifest and other data files
ExpiresByType application/json "access plus 0 seconds"
ExpiresByType application/xml "access plus 0 seconds"
ExpiresByType text/xml "access plus 0 seconds"
</IfModule>

# Proper MIME types
<IfModule mod_mime.c>
# JavaScript
AddType application/javascript js
AddType application/json json
    
# Fonts
AddType font/woff woff
AddType font/woff2 woff2
AddType application/vnd.ms-fontobject eot
AddType font/ttf ttf
AddType font/otf otf
    
# Images
AddType image/svg+xml svg svgz
AddType image/webp webp
    
# Manifest
AddType application/manifest+json webmanifest
AddType application/x-web-app-manifest+json webapp
AddType text/cache-manifest appcache
</IfModule>

# Gzip Compression
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
AddOutputFilterByType DEFLATE text/javascript application/javascript application/x-javascript
AddOutputFilterByType DEFLATE application/json application/xml
AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# UTF-8 Encoding
AddDefaultCharset utf-8
AddCharset utf-8 .html .css .js .json .xml .rss .atom
